{
  "id": "routine_4f1c2d2a-7b9f-4f1e-b2db-6a7f6e2c8f41",
  "created_at": 1762292460,
  "updated_at": 1762292460,
  "name": "Spirit flight availability search (v3/search)",
  "description": "Automates Spirit token retrieval and flight availability search using observed endpoints and payloads (v3/search and prod-token).",
  "operations": [
    {
      "type": "navigate",
      "url": "https://www.spirit.com/book/flights"
    },
    {
      "type": "sleep",
      "timeout_seconds": 2.5
    },
    {
      "type": "fetch",
      "endpoint": {
        "url": "https://www.spirit.com/api/prod-token/api/v1/token",
        "description": "Issue JWT used for subsequent API calls (returns data.token).",
        "method": "POST",
        "headers": {
          "sec-ch-ua-platform": "macOS",
          "Cache-Control": "no-cache",
          "Referer": "https://www.spirit.com/",
          "Pragma": "no-cache",
          "sec-ch-ua": "\"Chromium\";v=\"142\", \"Google Chrome\";v=\"142\", \"Not_A Brand\";v=\"99\"",
          "sec-ch-ua-mobile": "?0",
          "Ocp-Apim-Subscription-Key": "3b6a6994753b4efc86376552e52b8432",
          "Accept": "application/json, text/plain, */*",
          "Content-Type": "application/json",
          "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36"
        },
        "body": {
          "applicationName": "dotRezWeb"
        },
        "credentials": "same-origin"
      },
      "session_storage_key": "token_response"
    },
    {
      "type": "fetch",
      "endpoint": {
        "url": "https://www.spirit.com/api/prod-availability/api/availability/v3/search",
        "description": "Search flight availability by origin, destination, and dates (supports one-way or roundtrip via criteria array).",
        "method": "POST",
        "headers": {
          "sec-ch-ua-platform": "macOS",
          "Authorization": "Bearer \"{{sessionStorage:token_response.data.token}}\"",
          "Cache-Control": "no-cache",
          "Referer": "https://www.spirit.com/book/flights",
          "Accept-Language": "en-US",
          "Pragma": "no-cache",
          "sec-ch-ua": "\"Chromium\";v=\"142\", \"Google Chrome\";v=\"142\", \"Not_A Brand\";v=\"99\"",
          "sec-ch-ua-mobile": "?0",
          "Ocp-Apim-Subscription-Key": "3b6a6994753b4efc86376552e52b8432",
          "Accept": "application/json, text/plain, */*",
          "Content-Type": "application/json",
          "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36"
        },
        "body": {
          "includeWifiAvailability": true,
          "criteria": [
            {
              "stations": {
                "originStationCodes": [
                  "\"{{origin_code}}\""
                ],
                "destinationStationCodes": [
                  "\"{{destination_code}}\""
                ],
                "searchDestinationMacs": false
              },
              "dates": {
                "beginDate": "\"{{depart_begin_date}}\"",
                "endDate": "\"{{depart_end_date}}\""
              },
              "filters": {
                "filter": "Default"
              }
            },
            {
              "stations": {
                "originStationCodes": [
                  "\"{{destination_code}}\""
                ],
                "destinationStationCodes": [
                  "\"{{origin_code}}\""
                ],
                "searchOriginMacs": false
              },
              "dates": {
                "beginDate": "\"{{return_begin_date}}\"",
                "endDate": "\"{{return_end_date}}\""
              },
              "filters": {
                "filter": "Default"
              }
            }
          ],
          "passengers": {
            "types": [
              {
                "type": "ADT",
                "count": "{{passenger_adults}}"
              }
            ]
          },
          "codes": {
            "currency": "USD"
          },
          "fareFilters": {
            "loyalty": "MonetaryOnly",
            "types": [],
            "classControl": 1
          },
          "taxesAndFees": "TaxesAndFees",
          "originalJourneyKeys": [],
          "originalBookingRecordLocator": null,
          "infantCount": 0,
          "birthDates": [],
          "includeBundleAvailability": true
        },
        "credentials": "same-origin"
      },
      "session_storage_key": "availability_search_response"
    },
    {
      "type": "return",
      "session_storage_key": "availability_search_response"
    }
  ],
  "incognito": true,
  "parameters": [
    {
      "name": "origin_code",
      "type": "string",
      "required": true,
      "description": "IATA origin station code.",
      "default": null,
      "examples": [
        "BOS"
      ],
      "min_length": 3,
      "max_length": 3,
      "min_value": null,
      "max_value": null,
      "pattern": "^[A-Z]{3}$",
      "enum_values": null,
      "format": null
    },
    {
      "name": "destination_code",
      "type": "string",
      "required": true,
      "description": "IATA destination station code.",
      "default": null,
      "examples": [
        "ATL"
      ],
      "min_length": 3,
      "max_length": 3,
      "min_value": null,
      "max_value": null,
      "pattern": "^[A-Z]{3}$",
      "enum_values": null,
      "format": null
    },
    {
      "name": "depart_begin_date",
      "type": "date",
      "required": true,
      "description": "Outbound begin date (YYYY-MM-DD).",
      "default": null,
      "examples": [
        "2025-11-05"
      ],
      "min_length": null,
      "max_length": null,
      "min_value": null,
      "max_value": null,
      "pattern": null,
      "enum_values": null,
      "format": "YYYY-MM-DD"
    },
    {
      "name": "depart_end_date",
      "type": "date",
      "required": true,
      "description": "Outbound end date (YYYY-MM-DD).",
      "default": null,
      "examples": [
        "2025-11-05"
      ],
      "min_length": null,
      "max_length": null,
      "min_value": null,
      "max_value": null,
      "pattern": null,
      "enum_values": null,
      "format": "YYYY-MM-DD"
    },
    {
      "name": "return_begin_date",
      "type": "date",
      "required": true,
      "description": "Return begin date (YYYY-MM-DD). For one-way, set same as depart and the server will ignore the second leg.",
      "default": null,
      "examples": [
        "2025-11-08"
      ],
      "min_length": null,
      "max_length": null,
      "min_value": null,
      "max_value": null,
      "pattern": null,
      "enum_values": null,
      "format": "YYYY-MM-DD"
    },
    {
      "name": "return_end_date",
      "type": "date",
      "required": true,
      "description": "Return end date (YYYY-MM-DD). For one-way, set same as depart and the server will ignore the second leg.",
      "default": null,
      "examples": [
        "2025-11-08"
      ],
      "min_length": null,
      "max_length": null,
      "min_value": null,
      "max_value": null,
      "pattern": null,
      "enum_values": null,
      "format": "YYYY-MM-DD"
    },
    {
      "name": "passenger_adults",
      "type": "integer",
      "required": true,
      "description": "Number of adult passengers (ADT).",
      "default": 1,
      "examples": [
        1
      ],
      "min_length": null,
      "max_length": null,
      "min_value": 1,
      "max_value": 9,
      "pattern": null,
      "enum_values": null,
      "format": null
    }
  ]
}